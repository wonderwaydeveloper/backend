version: '3.8'

services:
  nginx-rtmp:
    image: tiangolo/nginx-rtmp
    container_name: wonderway-rtmp
    ports:
      - "1935:1935"  # RTMP port
      - "8080:80"    # HLS port
    volumes:
      - ./docker/nginx/nginx.conf:/etc/nginx/nginx.conf
      - ./storage/streams:/var/www/html/hls
      - ./storage/recordings:/var/www/html/recordings
    networks:
      - wonderway-network

  ffmpeg:
    image: jrottenberg/ffmpeg:4.4-alpine
    container_name: wonderway-ffmpeg
    volumes:
      - ./storage/streams:/streams
      - ./storage/recordings:/recordings
      - ./docker/ffmpeg:/scripts
    networks:
      - wonderway-network
    depends_on:
      - nginx-rtmp

  redis-streaming:
    image: redis:7-alpine
    container_name: wonderway-redis-streaming
    ports:
      - "6380:6379"
    volumes:
      - ./storage/redis-streaming:/data
    networks:
      - wonderway-network

networks:
  wonderway-network:
    driver: bridge

volumes:
  streams:
  recordings:
  redis-streaming: