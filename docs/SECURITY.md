# Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ù…Ù†ÛŒØª WonderWay

## Ù…Ù‚Ø¯Ù…Ù‡

Ø§Ù…Ù†ÛŒØª Ø¯Ø± Ù¾Ù„ØªÙØ±Ù… WonderWay Ø¯Ø± Ø§ÙˆÙ„ÙˆÛŒØª Ù‚Ø±Ø§Ø± Ø¯Ø§Ø±Ø¯. Ø§ÛŒÙ† Ø³Ù†Ø¯ Ø´Ø§Ù…Ù„ ØªÙ…Ø§Ù… Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ø§Ù…Ù†ÛŒØªÛŒØŒ Ø¨Ù‡ØªØ±ÛŒÙ† Ø´ÛŒÙˆÙ‡Ù‡Ø§ Ùˆ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÙ‡Ø§ÛŒ Ù¾ÛŒØ§Ø¯Ù‡Ø³Ø§Ø²ÛŒ Ø§Ù…Ù†ÛŒØª Ø§Ø³Øª.

## ÙÙ‡Ø±Ø³Øª Ù…Ø·Ø§Ù„Ø¨

- [Ø§ØµÙˆÙ„ Ø§Ù…Ù†ÛŒØªÛŒ](#Ø§ØµÙˆÙ„-Ø§Ù…Ù†ÛŒØªÛŒ)
- [Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ùˆ Ù…Ø¬ÙˆØ²Ø¯Ù‡ÛŒ](#Ø§Ø­Ø±Ø§Ø²-Ù‡ÙˆÛŒØª-Ùˆ-Ù…Ø¬ÙˆØ²Ø¯Ù‡ÛŒ)
- [Ø­ÙØ§Ø¸Øª Ø§Ø² Ø¯Ø§Ø¯Ù‡Ù‡Ø§](#Ø­ÙØ§Ø¸Øª-Ø§Ø²-Ø¯Ø§Ø¯Ù‡Ù‡Ø§)
- [Ø§Ù…Ù†ÛŒØª Ø´Ø¨Ú©Ù‡](#Ø§Ù…Ù†ÛŒØª-Ø´Ø¨Ú©Ù‡)
- [Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ø§Ù…Ù†ÛŒØªÛŒ](#Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯-Ø§Ù…Ù†ÛŒØªÛŒ)
- [Ù…Ø¯ÛŒØ±ÛŒØª Ø¢Ø³ÛŒØ¨Ù¾Ø°ÛŒØ±ÛŒÙ‡Ø§](#Ù…Ø¯ÛŒØ±ÛŒØª-Ø¢Ø³ÛŒØ¨Ù¾Ø°ÛŒØ±ÛŒÙ‡Ø§)
- [Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ø­ÙˆØ§Ø¯Ø«](#Ù¾Ø§Ø³Ø®-Ø¨Ù‡-Ø­ÙˆØ§Ø¯Ø«)
- [Compliance](#compliance)

---

## Ø§ØµÙˆÙ„ Ø§Ù…Ù†ÛŒØªÛŒ

### Defense in Depth (Ø¯ÙØ§Ø¹ Ú†Ù†Ø¯Ù„Ø§ÛŒÙ‡)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Edge Security                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      CDN        â”‚  â”‚       WAF       â”‚  â”‚   DDoS       â”‚ â”‚
â”‚  â”‚   Protection    â”‚  â”‚   Filtering     â”‚  â”‚ Protection   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Network Security                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚    Firewall     â”‚  â”‚   Load Balancer â”‚  â”‚     VPN      â”‚ â”‚
â”‚  â”‚     Rules       â”‚  â”‚   SSL/TLS       â”‚  â”‚   Access     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Application Security                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Authentication  â”‚  â”‚  Authorization  â”‚  â”‚ Input Valid  â”‚ â”‚
â”‚  â”‚      & 2FA      â”‚  â”‚     & RBAC      â”‚  â”‚ & Sanitize   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Data Security                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Encryption    â”‚  â”‚   Data Loss     â”‚  â”‚   Backup     â”‚ â”‚
â”‚  â”‚  at Rest/Transitâ”‚  â”‚   Prevention    â”‚  â”‚ & Recovery   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Zero Trust Architecture

```php
class ZeroTrustMiddleware
{
    public function handle(Request $request, Closure $next)
    {
        // 1. Ù‡ÛŒÚ† Ú©Ø³ Ùˆ Ù‡ÛŒÚ† Ú†ÛŒØ² Ù‚Ø§Ø¨Ù„ Ø§Ø¹ØªÙ…Ø§Ø¯ Ù†ÛŒØ³Øª
        $this->verifyIdentity($request);
        
        // 2. Ø¯Ø³ØªØ±Ø³ÛŒ Ø­Ø¯Ø§Ù‚Ù„ÛŒ
        $this->enforceMinimalAccess($request);
        
        // 3. ØªØ£ÛŒÛŒØ¯ Ù…Ø¯Ø§ÙˆÙ…
        $this->continuousVerification($request);
        
        // 4. Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ù…Ø¯Ø§ÙˆÙ…
        $this->logSecurityEvent($request);
        
        return $next($request);
    }
}
```

---

## Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ùˆ Ù…Ø¬ÙˆØ²Ø¯Ù‡ÛŒ

### Multi-Factor Authentication (2FA)

#### Ù¾ÛŒØ§Ø¯Ù‡Ø³Ø§Ø²ÛŒ 2FA Ø¨Ø§ Google Authenticator

```php
class TwoFactorService
{
    private Google2FA $google2fa;
    
    public function generateSecret(): string
    {
        return $this->google2fa->generateSecretKey();
    }
    
    public function generateQRCode(User $user, string $secret): string
    {
        return $this->google2fa->getQRCodeUrl(
            config('app.name'),
            $user->email,
            $secret
        );
    }
    
    public function verifyCode(string $secret, string $code): bool
    {
        return $this->google2fa->verifyKey($secret, $code);
    }
    
    public function enable2FA(User $user, string $code): bool
    {
        if (!$this->verifyCode($user->two_factor_secret, $code)) {
            throw new InvalidTwoFactorCodeException();
        }
        
        $user->update([
            'two_factor_enabled' => true,
            'two_factor_backup_codes' => $this->generateBackupCodes()
        ]);
        
        // Ù„Ø§Ú¯ Ø§Ù…Ù†ÛŒØªÛŒ
        $this->logSecurityEvent('2fa_enabled', $user);
        
        return true;
    }
    
    private function generateBackupCodes(): array
    {
        $codes = [];
        for ($i = 0; $i < 10; $i++) {
            $codes[] = Str::random(8);
        }
        return $codes;
    }
}
```

#### JWT Security

```php
class SecureJWTService
{
    private string $privateKey;
    private string $publicKey;
    
    public function generateToken(User $user): string
    {
        $payload = [
            'sub' => $user->id,
            'email' => $user->email,
            'iat' => time(),
            'exp' => time() + config('jwt.ttl'),
            'jti' => Str::uuid(), // Unique token ID
            'aud' => config('app.url'),
            'iss' => config('app.name'),
            // Security claims
            'ip' => request()->ip(),
            'user_agent' => request()->userAgent(),
            'session_id' => session()->getId()
        ];
        
        return JWT::encode($payload, $this->privateKey, 'RS256');
    }
    
    public function validateToken(string $token): array
    {
        try {
            $decoded = JWT::decode($token, new Key($this->publicKey, 'RS256'));
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ Ø§Ø¶Ø§ÙÛŒ
            $this->validateSecurityClaims($decoded);
            
            return (array) $decoded;
        } catch (Exception $e) {
            $this->logSecurityEvent('invalid_token_attempt', [
                'token' => substr($token, 0, 20) . '...',
                'error' => $e->getMessage(),
                'ip' => request()->ip()
            ]);
            
            throw new InvalidTokenException();
        }
    }
    
    private function validateSecurityClaims(object $claims): void
    {
        // Ø¨Ø±Ø±Ø³ÛŒ IP (Ø§Ø®ØªÛŒØ§Ø±ÛŒ - Ø¨Ø±Ø§ÛŒ Ø§Ù…Ù†ÛŒØª Ø¨ÛŒØ´ØªØ±)
        if (config('security.strict_ip_validation') && 
            $claims->ip !== request()->ip()) {
            throw new TokenSecurityException('IP mismatch');
        }
        
        // Ø¨Ø±Ø±Ø³ÛŒ User Agent
        if ($claims->user_agent !== request()->userAgent()) {
            $this->logSecurityEvent('suspicious_token_usage', [
                'original_ua' => $claims->user_agent,
                'current_ua' => request()->userAgent()
            ]);
        }
    }
}
```

### Role-Based Access Control (RBAC)

```php
class RolePermissionSystem
{
    public function defineRoles(): void
    {
        // Ù†Ù‚Ø´Ù‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ…
        Role::create(['name' => 'super_admin']);
        Role::create(['name' => 'admin']);
        Role::create(['name' => 'moderator']);
        Role::create(['name' => 'premium_user']);
        Role::create(['name' => 'user']);
        Role::create(['name' => 'restricted_user']);
        
        // Ù…Ø¬ÙˆØ²Ù‡Ø§
        Permission::create(['name' => 'manage_users']);
        Permission::create(['name' => 'manage_posts']);
        Permission::create(['name' => 'moderate_content']);
        Permission::create(['name' => 'view_analytics']);
        Permission::create(['name' => 'manage_system']);
        
        // ØªØ®ØµÛŒØµ Ù…Ø¬ÙˆØ²Ù‡Ø§ Ø¨Ù‡ Ù†Ù‚Ø´Ù‡Ø§
        $this->assignPermissionsToRoles();
    }
    
    private function assignPermissionsToRoles(): void
    {
        $superAdmin = Role::findByName('super_admin');
        $superAdmin->givePermissionTo(Permission::all());
        
        $admin = Role::findByName('admin');
        $admin->givePermissionTo([
            'manage_users',
            'manage_posts',
            'moderate_content',
            'view_analytics'
        ]);
        
        $moderator = Role::findByName('moderator');
        $moderator->givePermissionTo([
            'moderate_content',
            'manage_posts'
        ]);
    }
}

// Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± Controller
class AdminController extends Controller
{
    public function __construct()
    {
        $this->middleware('permission:manage_users');
    }
    
    public function deleteUser(User $user)
    {
        // Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø¶Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª Ø­Ø³Ø§Ø³
        if (!auth()->user()->hasRole('admin|super_admin')) {
            abort(403, 'Insufficient privileges');
        }
        
        // Ù„Ø§Ú¯ Ø§Ù…Ù†ÛŒØªÛŒ
        $this->logSecurityEvent('user_deleted', [
            'deleted_user_id' => $user->id,
            'admin_id' => auth()->id()
        ]);
        
        $user->delete();
    }
}
```

---

## Ø­ÙØ§Ø¸Øª Ø§Ø² Ø¯Ø§Ø¯Ù‡Ù‡Ø§

### Ø±Ù…Ø²Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡Ù‡Ø§

#### Encryption at Rest

```php
class DatabaseEncryptionService
{
    public function encryptSensitiveData(array $data): array
    {
        $encryptedData = [];
        
        foreach ($data as $key => $value) {
            if ($this->isSensitiveField($key)) {
                $encryptedData[$key] = encrypt($value);
            } else {
                $encryptedData[$key] = $value;
            }
        }
        
        return $encryptedData;
    }
    
    public function decryptSensitiveData(array $data): array
    {
        $decryptedData = [];
        
        foreach ($data as $key => $value) {
            if ($this->isSensitiveField($key)) {
                try {
                    $decryptedData[$key] = decrypt($value);
                } catch (DecryptException $e) {
                    // Ù„Ø§Ú¯ Ø®Ø·Ø§ÛŒ Ø±Ù…Ø²Ú¯Ø´Ø§ÛŒÛŒ
                    Log::error('Decryption failed', [
                        'field' => $key,
                        'error' => $e->getMessage()
                    ]);
                    $decryptedData[$key] = null;
                }
            } else {
                $decryptedData[$key] = $value;
            }
        }
        
        return $decryptedData;
    }
    
    private function isSensitiveField(string $field): bool
    {
        $sensitiveFields = [
            'phone',
            'national_id',
            'credit_card',
            'bank_account',
            'two_factor_secret'
        ];
        
        return in_array($field, $sensitiveFields);
    }
}
```

#### Field-Level Encryption

```php
class User extends Model
{
    protected $encrypted = [
        'phone',
        'two_factor_secret'
    ];
    
    public function setPhoneAttribute($value)
    {
        $this->attributes['phone'] = encrypt($value);
    }
    
    public function getPhoneAttribute($value)
    {
        return $value ? decrypt($value) : null;
    }
}
```

### Data Loss Prevention (DLP)

```php
class DataLeakagePreventionService
{
    public function scanContent(string $content): array
    {
        $violations = [];
        
        // Ø¨Ø±Ø±Ø³ÛŒ Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª Ø§Ø¹ØªØ¨Ø§Ø±ÛŒ
        if ($this->containsCreditCard($content)) {
            $violations[] = [
                'type' => 'credit_card',
                'severity' => 'high',
                'message' => 'Credit card number detected'
            ];
        }
        
        // Ø¨Ø±Ø±Ø³ÛŒ Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†
        if ($this->containsPhoneNumber($content)) {
            $violations[] = [
                'type' => 'phone_number',
                'severity' => 'medium',
                'message' => 'Phone number detected'
            ];
        }
        
        // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ…ÛŒÙ„
        if ($this->containsEmail($content)) {
            $violations[] = [
                'type' => 'email',
                'severity' => 'low',
                'message' => 'Email address detected'
            ];
        }
        
        return $violations;
    }
    
    private function containsCreditCard(string $content): bool
    {
        // Ø§Ù„Ú¯ÙˆÛŒ Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª Ø§Ø¹ØªØ¨Ø§Ø±ÛŒ
        $pattern = '/\b(?:\d{4}[-\s]?){3}\d{4}\b/';
        return preg_match($pattern, $content);
    }
    
    private function containsPhoneNumber(string $content): bool
    {
        // Ø§Ù„Ú¯ÙˆÛŒ Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† Ø§ÛŒØ±Ø§Ù†ÛŒ
        $pattern = '/(\+98|0)?9\d{9}/';
        return preg_match($pattern, $content);
    }
}
```

---

## Ø§Ù…Ù†ÛŒØª Ø´Ø¨Ú©Ù‡

### Web Application Firewall (WAF)

```php
class WAFMiddleware
{
    private array $rules = [
        'sql_injection' => [
            'patterns' => [
                '/(\bunion\b.*\bselect\b)/i',
                '/(\bselect\b.*\bfrom\b)/i',
                '/(\binsert\b.*\binto\b)/i',
                '/(\bdelete\b.*\bfrom\b)/i',
                '/(\bdrop\b.*\btable\b)/i'
            ],
            'action' => 'block'
        ],
        'xss_attack' => [
            'patterns' => [
                '/<script[^>]*>.*?<\/script>/i',
                '/javascript:/i',
                '/on\w+\s*=/i',
                '/<iframe[^>]*>.*?<\/iframe>/i'
            ],
            'action' => 'sanitize'
        ],
        'path_traversal' => [
            'patterns' => [
                '/\.\.\//',
                '/\.\.\\\\/',
                '/\.\.\%2f/',
                '/\.\.\%5c/'
            ],
            'action' => 'block'
        ]
    ];
    
    public function handle(Request $request, Closure $next)
    {
        // Ø¨Ø±Ø±Ø³ÛŒ IP Ø¯Ø± Ù„ÛŒØ³Øª Ø³ÛŒØ§Ù‡
        if ($this->isBlacklistedIP($request->ip())) {
            $this->logSecurityEvent('blocked_ip_attempt', [
                'ip' => $request->ip(),
                'user_agent' => $request->userAgent()
            ]);
            abort(403, 'Access denied');
        }
        
        // Ø¨Ø±Ø±Ø³ÛŒ Ù‚ÙˆØ§Ù†ÛŒÙ† WAF
        foreach ($this->rules as $ruleName => $rule) {
            if ($this->checkRule($request, $rule)) {
                $this->handleRuleViolation($request, $ruleName, $rule);
            }
        }
        
        return $next($request);
    }
    
    private function checkRule(Request $request, array $rule): bool
    {
        $content = $request->getContent() . ' ' . $request->fullUrl();
        
        foreach ($rule['patterns'] as $pattern) {
            if (preg_match($pattern, $content)) {
                return true;
            }
        }
        
        return false;
    }
    
    private function handleRuleViolation(Request $request, string $ruleName, array $rule): void
    {
        $this->logSecurityEvent('waf_rule_violation', [
            'rule' => $ruleName,
            'ip' => $request->ip(),
            'url' => $request->fullUrl(),
            'user_agent' => $request->userAgent()
        ]);
        
        if ($rule['action'] === 'block') {
            abort(403, 'Request blocked by security policy');
        }
    }
}
```

### Rate Limiting Ù¾ÛŒØ´Ø±ÙØªÙ‡

```php
class AdvancedRateLimiter
{
    public function handle(Request $request, Closure $next, string $key = null)
    {
        $identifier = $this->getIdentifier($request, $key);
        $limits = $this->getLimitsForRequest($request);
        
        foreach ($limits as $limit) {
            if ($this->tooManyAttempts($identifier, $limit)) {
                $this->handleRateLimitExceeded($request, $identifier, $limit);
            }
        }
        
        $this->incrementAttempts($identifier, $limits);
        
        return $next($request);
    }
    
    private function getLimitsForRequest(Request $request): array
    {
        $limits = [];
        
        // Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø¹Ù…ÙˆÙ…ÛŒ
        $limits[] = [
            'key' => 'general',
            'max_attempts' => 60,
            'decay_minutes' => 1
        ];
        
        // Ù…Ø­Ø¯ÙˆØ¯ÛŒØª ÙˆÛŒÚ˜Ù‡ Ø¨Ø±Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª Ø­Ø³Ø§Ø³
        if ($this->isSensitiveOperation($request)) {
            $limits[] = [
                'key' => 'sensitive',
                'max_attempts' => 5,
                'decay_minutes' => 15
            ];
        }
        
        // Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†Ù‚Ø´ Ú©Ø§Ø±Ø¨Ø±
        if ($user = $request->user()) {
            if ($user->hasRole('premium')) {
                $limits[0]['max_attempts'] = 120; // Ø¯Ùˆ Ø¨Ø±Ø§Ø¨Ø± Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù¾Ø±ÛŒÙ…ÛŒÙˆÙ…
            }
        }
        
        return $limits;
    }
    
    private function handleRateLimitExceeded(Request $request, string $identifier, array $limit): void
    {
        $this->logSecurityEvent('rate_limit_exceeded', [
            'identifier' => $identifier,
            'limit' => $limit,
            'ip' => $request->ip(),
            'user_id' => $request->user()?->id
        ]);
        
        // Ø¨Ù„Ø§Ú© Ù…ÙˆÙ‚Øª IP Ø¯Ø± ØµÙˆØ±Øª ØªÚ©Ø±Ø§Ø±
        if ($this->shouldBlockIP($identifier)) {
            $this->blockIP($request->ip(), 3600); // 1 Ø³Ø§Ø¹Øª
        }
        
        abort(429, 'Too many requests');
    }
}
```

### DDoS Protection

```php
class DDoSProtectionService
{
    public function detectDDoSAttack(Request $request): bool
    {
        $ip = $request->ip();
        $currentTime = time();
        
        // Ø¨Ø±Ø±Ø³ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ø± Ø¯Ù‚ÛŒÙ‚Ù‡ Ú¯Ø°Ø´ØªÙ‡
        $requestCount = Redis::zcount(
            "requests:{$ip}",
            $currentTime - 60,
            $currentTime
        );
        
        if ($requestCount > config('security.ddos_threshold', 100)) {
            $this->handleDDoSAttack($ip, $requestCount);
            return true;
        }
        
        // Ø«Ø¨Øª Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¬Ø¯ÛŒØ¯
        Redis::zadd("requests:{$ip}", $currentTime, $currentTime);
        Redis::expire("requests:{$ip}", 300); // 5 Ø¯Ù‚ÛŒÙ‚Ù‡
        
        return false;
    }
    
    private function handleDDoSAttack(string $ip, int $requestCount): void
    {
        // Ù„Ø§Ú¯ Ø­Ù…Ù„Ù‡
        Log::critical('DDoS attack detected', [
            'ip' => $ip,
            'request_count' => $requestCount,
            'timestamp' => now()
        ]);
        
        // Ø¨Ù„Ø§Ú© IP
        $this->blockIP($ip, 7200); // 2 Ø³Ø§Ø¹Øª
        
        // Ø§Ø¹Ù„Ø§Ù† Ø¨Ù‡ ØªÛŒÙ… Ø§Ù…Ù†ÛŒØª
        $this->notifySecurityTeam($ip, $requestCount);
        
        // ÙØ¹Ø§Ù„Ø³Ø§Ø²ÛŒ Ø­Ø§Ù„Øª Ù…Ø­Ø§ÙØ¸Øª
        $this->enableProtectionMode();
    }
}
```

---

## Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ø§Ù…Ù†ÛŒØªÛŒ

### Security Event Logging

```php
class SecurityEventLogger
{
    public function logEvent(string $eventType, array $data = []): void
    {
        $logData = [
            'event_type' => $eventType,
            'timestamp' => now()->toISOString(),
            'ip_address' => request()->ip(),
            'user_agent' => request()->userAgent(),
            'user_id' => auth()->id(),
            'session_id' => session()->getId(),
            'data' => $data,
            'severity' => $this->getSeverity($eventType),
            'risk_score' => $this->calculateRiskScore($eventType, $data)
        ];
        
        // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± ÙØ§ÛŒÙ„ Ù„Ø§Ú¯ Ø§Ù…Ù†ÛŒØªÛŒ
        Log::channel('security')->info($eventType, $logData);
        
        // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ ØªØ­Ù„ÛŒÙ„
        SecurityLog::create($logData);
        
        // Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ SIEM Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø²
        if ($this->shouldSendToSIEM($eventType)) {
            $this->sendToSIEM($logData);
        }
        
        // Ù‡Ø´Ø¯Ø§Ø± ÙÙˆØ±ÛŒ Ø¨Ø±Ø§ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø¨Ø­Ø±Ø§Ù†ÛŒ
        if ($logData['severity'] === 'critical') {
            $this->sendImmediateAlert($logData);
        }
    }
    
    private function getSeverity(string $eventType): string
    {
        $severityMap = [
            'login_failed' => 'low',
            'login_success' => 'info',
            'password_changed' => 'medium',
            '2fa_disabled' => 'high',
            'admin_login' => 'high',
            'sql_injection_attempt' => 'critical',
            'xss_attempt' => 'high',
            'ddos_attack' => 'critical',
            'data_breach_attempt' => 'critical'
        ];
        
        return $severityMap[$eventType] ?? 'medium';
    }
    
    private function calculateRiskScore(string $eventType, array $data): int
    {
        $baseScore = [
            'login_failed' => 10,
            'sql_injection_attempt' => 90,
            'xss_attempt' => 70,
            'ddos_attack' => 95,
            'admin_login' => 50
        ][$eventType] ?? 30;
        
        // ØªØ¹Ø¯ÛŒÙ„ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¹ÙˆØ§Ù…Ù„ Ø§Ø¶Ø§ÙÛŒ
        if (isset($data['repeated_attempts']) && $data['repeated_attempts'] > 5) {
            $baseScore += 20;
        }
        
        if (isset($data['suspicious_ip']) && $data['suspicious_ip']) {
            $baseScore += 15;
        }
        
        return min($baseScore, 100);
    }
}
```

### Intrusion Detection System (IDS)

```php
class IntrusionDetectionSystem
{
    public function analyzeRequest(Request $request): array
    {
        $threats = [];
        
        // ØªØ­Ù„ÛŒÙ„ Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ Ù…Ø´Ú©ÙˆÚ©
        $threats = array_merge($threats, $this->detectSQLInjection($request));
        $threats = array_merge($threats, $this->detectXSS($request));
        $threats = array_merge($threats, $this->detectBruteForce($request));
        $threats = array_merge($threats, $this->detectAnomalousActivity($request));
        
        // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ù…ØªÛŒØ§Ø² ØªÙ‡Ø¯ÛŒØ¯ Ú©Ù„ÛŒ
        $totalThreatScore = array_sum(array_column($threats, 'score'));
        
        if ($totalThreatScore > config('security.threat_threshold', 70)) {
            $this->handleHighThreatLevel($request, $threats, $totalThreatScore);
        }
        
        return $threats;
    }
    
    private function detectAnomalousActivity(Request $request): array
    {
        $threats = [];
        $user = $request->user();
        
        if ($user) {
            // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ±ÙˆØ¯ Ø§Ø² Ù…Ú©Ø§Ù† ØºÛŒØ±Ø¹Ø§Ø¯ÛŒ
            if ($this->isUnusualLocation($user, $request->ip())) {
                $threats[] = [
                    'type' => 'unusual_location',
                    'score' => 40,
                    'description' => 'Login from unusual location'
                ];
            }
            
            // Ø¨Ø±Ø±Ø³ÛŒ ÙØ¹Ø§Ù„ÛŒØª ØºÛŒØ±Ø¹Ø§Ø¯ÛŒ
            if ($this->isUnusualActivity($user)) {
                $threats[] = [
                    'type' => 'unusual_activity',
                    'score' => 30,
                    'description' => 'Unusual user activity pattern'
                ];
            }
        }
        
        return $threats;
    }
    
    private function handleHighThreatLevel(Request $request, array $threats, int $score): void
    {
        // Ù„Ø§Ú¯ ØªÙ‡Ø¯ÛŒØ¯ Ø¨Ø§Ù„Ø§
        $this->logSecurityEvent('high_threat_detected', [
            'threats' => $threats,
            'total_score' => $score,
            'ip' => $request->ip(),
            'user_id' => $request->user()?->id
        ]);
        
        // Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ø®ÙˆØ¯Ú©Ø§Ø±
        if ($score > 90) {
            $this->blockIP($request->ip(), 3600);
            $this->notifySecurityTeam($threats, $score);
        }
        
        // Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø¯Ø³ØªØ±Ø³ÛŒ Ù…ÙˆÙ‚Øª
        if ($request->user()) {
            $this->temporaryRestriction($request->user(), $score);
        }
    }
}
```

### Real-time Threat Monitoring

```php
class ThreatMonitoringService
{
    public function startMonitoring(): void
    {
        // Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ù„Ø§Ú¯Ù‡Ø§ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ
        $this->monitorSecurityLogs();
        
        // Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ ØªØ±Ø§ÙÛŒÚ© Ø´Ø¨Ú©Ù‡
        $this->monitorNetworkTraffic();
        
        // Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ ØªØºÛŒÛŒØ±Ø§Øª ÙØ§ÛŒÙ„
        $this->monitorFileChanges();
        
        // Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ø¯Ø³ØªØ±Ø³ÛŒ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡
        $this->monitorDatabaseAccess();
    }
    
    private function monitorSecurityLogs(): void
    {
        // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Laravel Horizon Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø²Ø´ Real-time
        Redis::subscribe(['security-events'], function ($message) {
            $event = json_decode($message, true);
            
            if ($this->isHighRiskEvent($event)) {
                $this->triggerAlert($event);
            }
            
            // ØªØ­Ù„ÛŒÙ„ Ø§Ù„Ú¯Ùˆ
            $this->analyzePattern($event);
        });
    }
    
    private function analyzePattern(array $event): void
    {
        // ØªØ´Ø®ÛŒØµ Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ Ø­Ù…Ù„Ù‡
        $pattern = $this->detectAttackPattern($event);
        
        if ($pattern) {
            $this->handleAttackPattern($pattern);
        }
    }
}
```

---

## Ù…Ø¯ÛŒØ±ÛŒØª Ø¢Ø³ÛŒØ¨Ù¾Ø°ÛŒØ±ÛŒÙ‡Ø§

### Vulnerability Scanning

```php
class VulnerabilityScanner
{
    public function scanApplication(): array
    {
        $vulnerabilities = [];
        
        // Ø¨Ø±Ø±Ø³ÛŒ dependencies
        $vulnerabilities = array_merge(
            $vulnerabilities,
            $this->scanDependencies()
        );
        
        // Ø¨Ø±Ø±Ø³ÛŒ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ
        $vulnerabilities = array_merge(
            $vulnerabilities,
            $this->scanConfiguration()
        );
        
        // Ø¨Ø±Ø±Ø³ÛŒ Ú©Ø¯
        $vulnerabilities = array_merge(
            $vulnerabilities,
            $this->scanCode()
        );
        
        return $vulnerabilities;
    }
    
    private function scanDependencies(): array
    {
        $vulnerabilities = [];
        
        // Ø¨Ø±Ø±Ø³ÛŒ composer.lock Ø¨Ø±Ø§ÛŒ Ø¢Ø³ÛŒØ¨Ù¾Ø°ÛŒØ±ÛŒÙ‡Ø§ÛŒ Ø´Ù†Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡
        $composerAudit = shell_exec('composer audit --format=json');
        $auditResults = json_decode($composerAudit, true);
        
        if (isset($auditResults['advisories'])) {
            foreach ($auditResults['advisories'] as $advisory) {
                $vulnerabilities[] = [
                    'type' => 'dependency',
                    'severity' => $advisory['severity'],
                    'package' => $advisory['packageName'],
                    'title' => $advisory['title'],
                    'cve' => $advisory['cve'] ?? null
                ];
            }
        }
        
        return $vulnerabilities;
    }
    
    private function scanConfiguration(): array
    {
        $vulnerabilities = [];
        
        // Ø¨Ø±Ø±Ø³ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ù…Ù†ÛŒØªÛŒ
        if (config('app.debug') === true && app()->environment('production')) {
            $vulnerabilities[] = [
                'type' => 'configuration',
                'severity' => 'high',
                'title' => 'Debug mode enabled in production',
                'description' => 'APP_DEBUG should be false in production'
            ];
        }
        
        if (!config('session.secure') && request()->isSecure()) {
            $vulnerabilities[] = [
                'type' => 'configuration',
                'severity' => 'medium',
                'title' => 'Insecure session configuration',
                'description' => 'SESSION_SECURE_COOKIE should be true for HTTPS'
            ];
        }
        
        return $vulnerabilities;
    }
}
```

### Security Headers

```php
class SecurityHeadersMiddleware
{
    public function handle(Request $request, Closure $next)
    {
        $response = $next($request);
        
        // Content Security Policy
        $response->headers->set(
            'Content-Security-Policy',
            "default-src 'self'; " .
            "script-src 'self' 'unsafe-inline' https://cdn.wonderway.com; " .
            "style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; " .
            "img-src 'self' data: https:; " .
            "font-src 'self' https://fonts.gstatic.com; " .
            "connect-src 'self' wss: https:; " .
            "frame-ancestors 'none';"
        );
        
        // Security Headers
        $response->headers->set('X-Content-Type-Options', 'nosniff');
        $response->headers->set('X-Frame-Options', 'DENY');
        $response->headers->set('X-XSS-Protection', '1; mode=block');
        $response->headers->set('Referrer-Policy', 'strict-origin-when-cross-origin');
        $response->headers->set('Permissions-Policy', 'geolocation=(), microphone=(), camera=()');
        
        // HSTS Ø¨Ø±Ø§ÛŒ HTTPS
        if ($request->isSecure()) {
            $response->headers->set(
                'Strict-Transport-Security',
                'max-age=31536000; includeSubDomains; preload'
            );
        }
        
        return $response;
    }
}
```

---

## Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ø­ÙˆØ§Ø¯Ø«

### Incident Response Plan

```php
class IncidentResponseService
{
    public function handleSecurityIncident(array $incident): void
    {
        // 1. Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ùˆ Ø·Ø¨Ù‚Ù‡Ø¨Ù†Ø¯ÛŒ
        $classification = $this->classifyIncident($incident);
        
        // 2. Ù…Ù‡Ø§Ø± Ø§ÙˆÙ„ÛŒÙ‡
        $this->containIncident($incident, $classification);
        
        // 3. Ø§Ø¹Ù„Ø§Ù† Ø¨Ù‡ ØªÛŒÙ…
        $this->notifyIncidentTeam($incident, $classification);
        
        // 4. ØªØ­Ù„ÛŒÙ„ Ùˆ Ø¨Ø±Ø±Ø³ÛŒ
        $this->analyzeIncident($incident);
        
        // 5. Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ
        $this->recoverFromIncident($incident);
        
        // 6. Ú¯Ø²Ø§Ø±Ø´Ú¯ÛŒØ±ÛŒ
        $this->generateIncidentReport($incident);
    }
    
    private function classifyIncident(array $incident): array
    {
        $severity = 'low';
        $category = 'unknown';
        
        // ØªØ¹ÛŒÛŒÙ† Ø´Ø¯Øª Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙˆØ¹ Ø­Ø§Ø¯Ø«Ù‡
        switch ($incident['type']) {
            case 'data_breach':
                $severity = 'critical';
                $category = 'data_security';
                break;
            case 'ddos_attack':
                $severity = 'high';
                $category = 'availability';
                break;
            case 'unauthorized_access':
                $severity = 'high';
                $category = 'access_control';
                break;
            case 'malware_detected':
                $severity = 'medium';
                $category = 'malware';
                break;
        }
        
        return [
            'severity' => $severity,
            'category' => $category,
            'priority' => $this->calculatePriority($severity, $incident)
        ];
    }
    
    private function containIncident(array $incident, array $classification): void
    {
        switch ($classification['category']) {
            case 'data_security':
                // Ù‚Ø·Ø¹ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¯Ø§Ø¯Ù‡Ù‡Ø§ÛŒ Ø­Ø³Ø§Ø³
                $this->isolateAffectedSystems($incident);
                // ØªØºÛŒÛŒØ± Ø±Ù…Ø²Ù‡Ø§ÛŒ Ø¹Ø¨ÙˆØ±
                $this->forcePasswordReset($incident);
                break;
                
            case 'availability':
                // ÙØ¹Ø§Ù„Ø³Ø§Ø²ÛŒ DDoS protection
                $this->enableDDoSProtection();
                // Ø§Ù†ØªÙ‚Ø§Ù„ ØªØ±Ø§ÙÛŒÚ© Ø¨Ù‡ CDN
                $this->redirectToCDN();
                break;
                
            case 'access_control':
                // Ø¨Ù„Ø§Ú© Ú©Ø±Ø¯Ù† IP Ù‡Ø§ÛŒ Ù…Ø´Ú©ÙˆÚ©
                $this->blockSuspiciousIPs($incident);
                // ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø­Ø³Ø§Ø¨Ù‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ù…Ø´Ú©ÙˆÚ©
                $this->suspendSuspiciousAccounts($incident);
                break;
        }
    }
}
```

### Automated Response

```php
class AutomatedSecurityResponse
{
    public function handleThreat(array $threat): void
    {
        $responseLevel = $this->determineResponseLevel($threat);
        
        switch ($responseLevel) {
            case 'immediate':
                $this->immediateResponse($threat);
                break;
            case 'escalated':
                $this->escalatedResponse($threat);
                break;
            case 'monitored':
                $this->monitoredResponse($threat);
                break;
        }
    }
    
    private function immediateResponse(array $threat): void
    {
        // Ø¨Ù„Ø§Ú© ÙÙˆØ±ÛŒ IP
        $this->blockIP($threat['source_ip'], 3600);
        
        // ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ
        if (isset($threat['user_id'])) {
            $this->suspendUser($threat['user_id']);
        }
        
        // Ø§Ø¹Ù„Ø§Ù† ÙÙˆØ±ÛŒ Ø¨Ù‡ ØªÛŒÙ… Ø§Ù…Ù†ÛŒØª
        $this->sendEmergencyAlert($threat);
        
        // ÙØ¹Ø§Ù„Ø³Ø§Ø²ÛŒ Ø­Ø§Ù„Øª Ù…Ø­Ø§ÙØ¸Øª
        $this->enableLockdownMode();
    }
    
    private function enableLockdownMode(): void
    {
        // Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¹Ù…Ù„ÛŒØ§Øª Ø­Ø³Ø§Ø³
        Cache::put('security_lockdown', true, 3600);
        
        // Ø§ÙØ²Ø§ÛŒØ´ Ø³Ø·Ø­ Ù„Ø§Ú¯Ú¯ÛŒØ±ÛŒ
        config(['logging.level' => 'debug']);
        
        // ÙØ¹Ø§Ù„Ø³Ø§Ø²ÛŒ ØªØ£ÛŒÛŒØ¯ Ø§Ø¶Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª Ù…Ù‡Ù…
        config(['security.require_additional_verification' => true]);
    }
}
```

---

## Compliance

### GDPR Compliance

```php
class GDPRComplianceService
{
    public function handleDataRequest(string $type, User $user): array
    {
        switch ($type) {
            case 'export':
                return $this->exportUserData($user);
            case 'delete':
                return $this->deleteUserData($user);
            case 'rectify':
                return $this->rectifyUserData($user);
            default:
                throw new InvalidArgumentException('Invalid request type');
        }
    }
    
    private function exportUserData(User $user): array
    {
        return [
            'personal_data' => [
                'name' => $user->name,
                'email' => $user->email,
                'phone' => $user->phone,
                'created_at' => $user->created_at,
            ],
            'posts' => $user->posts()->get()->toArray(),
            'comments' => $user->comments()->get()->toArray(),
            'messages' => $user->sentMessages()->get()->toArray(),
            'activity_log' => $this->getUserActivityLog($user),
        ];
    }
    
    private function deleteUserData(User $user): array
    {
        DB::transaction(function () use ($user) {
            // Ø­Ø°Ù Ø¯Ø§Ø¯Ù‡Ù‡Ø§ÛŒ Ø´Ø®ØµÛŒ
            $user->posts()->delete();
            $user->comments()->delete();
            $user->messages()->delete();
            
            // Ù†Ø§Ø´Ù†Ø§Ø³ Ú©Ø±Ø¯Ù† Ø¯Ø§Ø¯Ù‡Ù‡Ø§ÛŒ Ø¨Ø§Ù‚ÛŒÙ…Ø§Ù†Ø¯Ù‡
            $user->update([
                'name' => 'Deleted User',
                'email' => 'deleted_' . $user->id . '@deleted.com',
                'phone' => null,
                'bio' => null,
                'avatar' => null,
            ]);
            
            // Ø¹Ù„Ø§Ù…ØªÚ¯Ø°Ø§Ø±ÛŒ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø­Ø°Ù Ø´Ø¯Ù‡
            $user->update(['deleted_at' => now()]);
        });
        
        return ['status' => 'completed', 'deleted_at' => now()];
    }
}
```

### Audit Trail

```php
class AuditTrailService
{
    public function logActivity(string $action, Model $model, array $changes = []): void
    {
        AuditLog::create([
            'user_id' => auth()->id(),
            'action' => $action,
            'auditable_type' => get_class($model),
            'auditable_id' => $model->id,
            'old_values' => $changes['old'] ?? null,
            'new_values' => $changes['new'] ?? null,
            'ip_address' => request()->ip(),
            'user_agent' => request()->userAgent(),
            'created_at' => now()
        ]);
    }
    
    public function getAuditTrail(Model $model): Collection
    {
        return AuditLog::where('auditable_type', get_class($model))
            ->where('auditable_id', $model->id)
            ->with('user')
            ->orderBy('created_at', 'desc')
            ->get();
    }
}
```

---

## Ø¨Ù‡ØªØ±ÛŒÙ† Ø´ÛŒÙˆÙ‡Ù‡Ø§ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ

### Secure Coding Practices

```php
// âœ… Ø¯Ø±Ø³Øª: Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Parameterized Queries
class SecurePostRepository
{
    public function searchPosts(string $query): Collection
    {
        return DB::table('posts')
            ->where('content', 'LIKE', '%' . $query . '%')
            ->get();
    }
}

// âŒ ØºÙ„Ø·: SQL Injection Ø¢Ø³ÛŒØ¨Ù¾Ø°ÛŒØ±
class InsecurePostRepository
{
    public function searchPosts(string $query): Collection
    {
        return DB::select("SELECT * FROM posts WHERE content LIKE '%{$query}%'");
    }
}

// âœ… Ø¯Ø±Ø³Øª: Input Validation
class PostController extends Controller
{
    public function store(Request $request)
    {
        $validated = $request->validate([
            'content' => 'required|string|max:280|profanity_filter',
            'image' => 'nullable|image|max:5120', // 5MB
        ]);
        
        // Sanitize content
        $validated['content'] = strip_tags($validated['content']);
        
        return Post::create($validated);
    }
}

// âœ… Ø¯Ø±Ø³Øª: Output Encoding
class PostResource extends JsonResource
{
    public function toArray($request)
    {
        return [
            'id' => $this->id,
            'content' => e($this->content), // HTML encoding
            'created_at' => $this->created_at,
        ];
    }
}
```

### Environment Security

```bash
# .env.production
APP_ENV=production
APP_DEBUG=false
APP_KEY=base64:generated-key-here

# Database
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=wonderway_prod
DB_USERNAME=wonderway_user
DB_PASSWORD=complex-secure-password

# Security
SESSION_SECURE_COOKIE=true
SESSION_HTTP_ONLY=true
SESSION_SAME_SITE=strict

# JWT
JWT_SECRET=very-long-random-secret-key
JWT_TTL=3600
JWT_REFRESH_TTL=20160

# Rate Limiting
RATE_LIMIT_ENABLED=true
RATE_LIMIT_ATTEMPTS=60
RATE_LIMIT_DECAY=1

# Security Headers
SECURITY_HEADERS_ENABLED=true
CSP_ENABLED=true
HSTS_ENABLED=true
```

### Regular Security Tasks

```php
// Scheduled Security Tasks
class SecurityMaintenanceCommand extends Command
{
    public function handle()
    {
        // Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ ØªÙˆÚ©Ù†Ù‡Ø§ÛŒ Ù…Ù†Ù‚Ø¶ÛŒ Ø´Ø¯Ù‡
        $this->cleanupExpiredTokens();
        
        // Ø¨Ø±Ø±Ø³ÛŒ Ø¢Ø³ÛŒØ¨Ù¾Ø°ÛŒØ±ÛŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯
        $this->checkForVulnerabilities();
        
        // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù‚ÙˆØ§Ù†ÛŒÙ† Ø§Ù…Ù†ÛŒØªÛŒ
        $this->updateSecurityRules();
        
        // ØªØ­Ù„ÛŒÙ„ Ù„Ø§Ú¯Ù‡Ø§ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ
        $this->analyzeSecurityLogs();
        
        // Ø¨Ú©Ø§Ù¾ Ø¯Ø§Ø¯Ù‡Ù‡Ø§ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ
        $this->backupSecurityData();
    }
    
    private function cleanupExpiredTokens(): void
    {
        PersonalAccessToken::where('expires_at', '<', now())->delete();
        PasswordResetToken::where('created_at', '<', now()->subHours(24))->delete();
    }
    
    private function checkForVulnerabilities(): void
    {
        $scanner = app(VulnerabilityScanner::class);
        $vulnerabilities = $scanner->scanApplication();
        
        if (!empty($vulnerabilities)) {
            $this->notifySecurityTeam($vulnerabilities);
        }
    }
}
```

---

## Ø®Ù„Ø§ØµÙ‡

Ø§Ù…Ù†ÛŒØª Ø¯Ø± WonderWay Ø´Ø§Ù…Ù„ Ù…ÙˆØ§Ø±Ø¯ Ø²ÛŒØ± Ø§Ø³Øª:

### âœ… Ù¾ÛŒØ§Ø¯Ù‡Ø³Ø§Ø²ÛŒ Ø´Ø¯Ù‡
- Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ú†Ù†Ø¯Ù…Ø±Ø­Ù„Ù‡Ø§ÛŒ (2FA)
- JWT Security Ø¨Ø§ RSA
- Role-Based Access Control
- Web Application Firewall
- Rate Limiting Ù¾ÛŒØ´Ø±ÙØªÙ‡
- Ø±Ù…Ø²Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡Ù‡Ø§
- Security Event Logging
- Intrusion Detection System
- GDPR Compliance
- Audit Trail

### ğŸ”„ Ø¯Ø± Ø­Ø§Ù„ ØªÙˆØ³Ø¹Ù‡
- Machine Learning Ø¨Ø±Ø§ÛŒ ØªØ´Ø®ÛŒØµ ØªÙ‡Ø¯ÛŒØ¯
- Behavioral Analytics
- Zero Trust Network Access
- Advanced Threat Protection

### ğŸ“‹ ÙˆØ¸Ø§ÛŒÙ Ù…Ø¯Ø§ÙˆÙ…
- Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…Ù†Ø¸Ù… dependencies
- Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ø¢Ø³ÛŒØ¨Ù¾Ø°ÛŒØ±ÛŒÙ‡Ø§
- ØªØ³Øª Ù†ÙÙˆØ° Ø¯ÙˆØ±Ù‡Ø§ÛŒ
- Ø¢Ù…ÙˆØ²Ø´ ØªÛŒÙ… Ø§Ù…Ù†ÛŒØª
- Ø¨Ø±Ø±Ø³ÛŒ Ùˆ Ø¨Ù‡Ø¨ÙˆØ¯ ÙØ±Ø¢ÛŒÙ†Ø¯Ù‡Ø§

Ø§Ù…Ù†ÛŒØª ÛŒÚ© ÙØ±Ø¢ÛŒÙ†Ø¯ Ù…Ø¯Ø§ÙˆÙ… Ø§Ø³Øª Ùˆ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ùˆ Ø¨Ù‡Ø¨ÙˆØ¯ Ù…Ø³ØªÙ…Ø± Ø¯Ø§Ø±Ø¯.